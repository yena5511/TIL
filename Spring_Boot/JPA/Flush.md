## Flush

- 영속성 컨텍스트의 변경 내영을 DB에 반영하는 것을 말한다.
-  commit 이 일어날 때 flush가 동작하는데, 이때 쓰기 지연 저장소에 쌓아 놨던 INSERT, UPDATE, DELETE SQL들이 DB에 날라간다.
- 영속성 컨텍스트의 변경 사항들과 DB의 상태를 맞추는 작업이다.

#### 동작과정

- 변경을 감지한다. (Dirty Checking)
- 수정된 Entity를 쓰기 지연 SQL 저장소에 등록한다.
- 쓰기 지연 SQL 저장소의 Query를 DB에 전송한다. (등록, 수정, 삭제 Query)

flish가 발생한다고 해서 commit이 이루어지는 것이 아니고 flush 다음에 실제 commit이 일어난다.
플러시가 동작할 수 있는 이유는 데이터베이스 트랜잭션(작업 단위)이라는 개념이 있기 때문이다.
영속성 컨텍스트는 비워지지 않는다.

#### 일어나는 경우

- 직접 호출
    - ```em.flush()```
    - 사용자가 메서드를 통해 영속성 컨텍스트 플러시
- 자동 호출
    - 트랜잭션 커밋 -> 플러시 호출
    - JPQL쿼리 실행 전 플러시 호출