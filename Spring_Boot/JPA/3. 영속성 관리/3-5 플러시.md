## 3-5 플러시 

플러시는 영속성 컨텍스트의 변경 내영을 데이터베이스에 반영한다.

플러시를 실행하면 구체적으로 다음과 같은 일이 일어난다.

1. 변경감지가 동작해서 영속성 컨텍스트에 있는 모든 엔티티를 스냅샷과 비교해서 수정된 엔티티를 찾는다.
수정된 엔티티는 수정 쿼리를 만들어 쓰기 지연 SQL저장소에 등록한다.
2. 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송한다.(등록, 수정,삭제쿼리)

영속성 컨텍스트를 플러시하는 방법은 3가지다.

1. em.flush()를 직접 호출한다.
2. 트랜잭션 커밋 시 플러기사 자동 호출된다.
3. JPQL 쿼리 실행 시 플러시가 자동 호출된다.

- 직접 호출

엔티티 매니저의 flush() 메소드를 직접 호출해서 영속성 컨텍스트를 강제로 플로시한다. 테스트나 다른 프레임워크와 JPA를 함께 사용할 때를 제외하고 거의 사용하지 않는다.

- 트랜잭션 커밋 시 플러시 자동 호출

데이터베이스에 변경 내용을 SQL로 전달하지 않고 트랜잭션만 커밋하면 어떤 데이터도 데이터베이스에 반영되지 않는다.
따라서 트랜잭션을 커밋하기 전에 꼭 플러시를 호출해서 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영해야 한다.
JPA는 이런 문제를 예방하기 위해 트랜잭션을 커밋할 때 플러시를 자동으로 호출된다.

- JPQL 쿼리 실행 시 플러시 자동 호출

JPQL이나 Criteria 같은 객체지향 쿼리를 호출할 때도 플러시가 실행된다.
왜 JPQL쿼리를 실행할 때 플러시가 자동호출 될까?
