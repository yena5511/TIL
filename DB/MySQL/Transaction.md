## Transaction

(Transaction 이하 트랜잭션)이란, 데이터베이스의 상태를 변화시키기 해서 수행하는 작업의 단위를 뜻한다.
간단하게 말해서 아래의 질의어(SQL)를 이용하여 데이터베이스를 접근 하는 것을 의미한다.

- SELECT
- INSERT
- DELETE
- UPDATE

작업단위는 많은 질의어 명령문들을 사람이 정하는 기준에 따라 정하는 것을 의미한다.

예시) 사용자 A가 사용자 B에게 만원을 송금한다
1. 사용자 A의 계좌에서 만원을 차감한다: UPDATE를 통해 사용자 A의 잔고 변경
2. 사용자 B의 계좌에 만원을 추가한다: UPDATE를 통해 사용자 B의 잔고 변경

#### 트랜잭션 특징
- 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적 단위이다.
- 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업 단위이다.
- 하나의 트랜잭션은 Commit 되거나 Rollback된다.


#### 트랜잭션 성질(ACID)

- 원자성 (Atomicity)
    - all or nothing
    - 원자성은 트랜잭션이 데이터베이스에 모두 반영되던가, 아니면 전혀 반영되지 않아야 한다는 것이다. 
    - 트랜잭션은 사람이 설계한논리적인 작업 단위로서, 일처리는 작업단위별로 이루어 져야 사람이 다루는데 무리가 없다.
    - 만약 트랜잭션 단위로 데이터가 처리되지 않는다면, 설계한 사람은 데이터 처리 시스템을 이해하기 힘들 뿐만 아니라, 오작동 했을시 원인을 찾기가 매우 힘들어질것이다.

    - savePoint
    ![](https://velog.velcdn.com/images/chldppwls12/post/e4dd2212-0d12-44be-9e09-3a15933dbfe7/image.png)
        - savePoint는 트랜잭션 내부에서 사용자가 지정할 수 있는 세부 작업 단위라고 생각할 수 있다. 
        - 특정 지점에 savePoint를 설정한 후 Rollback to savePoint1을 통해 해당 지점으로 롤백을 할 수 있다. 
        - 기억해야할 점은 아래 그림에서 SP1으로 롤백을 한 뒤에는 미래 시점인 SP2의 savePoint는 삭제된다는 것이다.

- 일관성(Consistency)
    -  일관성은 트랜잭션의 작업 처리 결과가 항상 일관성이 있어야 한다는 것이다.
    - 트랜잭션이 진행되는 동안에 데이터베이스가 변경 되더라도 업데이트된 데이터베이스로 트랜잭션이 진행되는것이 아니라,처음에 트랜잭션을 진행 하기 위해 참조한 데이터베이스로 진행된다. 
    - 이렇게 함으로써 각 사용자는 일관성 있는 데이터를 볼 수 있는 것이다.
- 독립성 (Isolation)
    -  독립성은 둘 이상의 트랜잭션이 동시에 실행되고 있을 경우 어떤 하나의 트랜잭션이라도, 다른 트랜잭션의 연산에 끼어들 수 없다는 점을 가리킨다.
    - 하나의 특정 트랜잭션이 완료될때까지, 다른 트랜잭션이 특정 트랜잭션의 결과를 참조할 수 없다.
    - isolation 성질을 보장할 수 있는 가장 쉬운 방법은 모든 트랜잭션을 순차적으로 수행하는 것이지만, 병렬적 수행의 장점을 얻기 위해 DBMS는 병렬적으로 수행하면서도 일렬 수행과 같은 결과를 보장할 수 있는 방식을 제공한다.

- 지속성 (Durability)
    -  지속성은 트랜잭션이 성공적으로 완료됬을 경우, 결과는 영구적으로 반영되어야 한다는 점이다.

#### 트랜잭션 연산 및 상태

- Commit 연산
    - Commit 연산은 한 개위 논리적 단위(트랜잭션)에 대한 작업이 성공적으로 끝나고
    데이터베이스가 다시 일관된  상태에 있을 때, 이 트랜잭션이 행한 갱신 연산이 완료된 것을 트랜잭션 관리자에게 알려주는 연산이다.
- Rollback 연산
    - Rollback 연산은 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Undo)하는 연산이다.
    - Rollback 시에는 해당 트랜잭션을 재시작하거나 폐기한다.

#### 트랜잭션의 상태

![](https://velog.velcdn.com/images/chldppwls12/post/beb5a194-9197-4cea-9eb8-618ddca89f5a/image.png)

- 활동(Active)
    - 트랜잭션이 실행 중인 상태

- 실패(Failed)
    - 트랜잭션 실행에 오류가 발생하여 중단된 상태

- 철회(Aborted)
    - 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태

- 부분 완료 
    - (Partially Committed)
트랜잭션의 마지막 연산까지 실행하고 Commit 연산이 실행되기 직전의 상태

- 완료(Committed)
    - 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태

- 부분완료 vs 완료
    - commit 요청이 들어오면 상태는 부분 완료 상태가 된다. 
    - 이후 commit을 문제 없이 수행할 수 있다면 완료 상태로 전이되고, 만약 오류가 발생하면 실패 상태가 된다. 
    - 즉 부분완료는 commit 요청이 들어왔을 때를 의미하고, 완료 상태는 commit을 정상적으로 완료한 상태를 의미한다.